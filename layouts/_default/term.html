{{ define "main" }}
  {{ .Scratch.Set "scope" "term" }}
  
  {{ $authorID := .Data.Term }}
  {{ $author := index site.Data.authors $authorID }}
  {{ $hasData := not (eq $author nil) }}

  <header class="mt-5">
    {{ if .Params.showBreadcrumbs | default (site.Params.term.showBreadcrumbs | default false) }}
      {{ partial "breadcrumbs.html" . }}
    {{ end }}

    {{ if $hasData }}
      {{/* CHANGED: Removed md:flex-row, added text-center, added items-center for vertical stacking */}}
      <div class="flex flex-col items-center gap-4 mt-8 mb-8 text-center">
        
        {{ if $author.image }}
          <div class="relative w-48 h-48 flex-shrink-0">
            {{ $imgURL := $author.image | relURL }}
            <img src="{{ $imgURL }}" class="rounded-full object-cover shadow-lg w-full h-full border-2 border-neutral-100 dark:border-neutral-700" alt="{{ $author.name }}">
          </div>
        {{ end }}

        <div class="flex-1 w-full">
          <h1 class="text-4xl font-extrabold text-neutral-900 dark:text-neutral flex flex-wrap justify-center items-center gap-3">
            {{ $author.name }}
            
          </h1>

          {{ if $author.bio }}
            <div class="mt-3 text-lg text-neutral-600 dark:text-neutral-300 max-w-2xl mx-auto">
              {{ $author.bio | markdownify }}
            </div>
          {{ end }}

          {{ if $author.social }}
          <div class="mt-6 flex flex-wrap justify-center gap-4">
            {{ range $social := $author.social }}
              {{ range $network, $link := $social }}
              <a href="{{ $link }}" target="_blank" rel="noopener noreferrer" class="text-neutral-500 hover:text-primary-600 dark:text-neutral-400 dark:hover:text-primary-400">
                <span class="w-3 h-6 inline-block">
                  {{ partial "icon.html" $network }}
                </span>
              </a>
              {{ end }}
            {{ end }}
          </div>
          {{ end }}

          {{ if $author.tags }}
            <div class="mt-8 max-w-2xl mx-auto flex flex-wrap justify-center gap-3">
              {{ range $author.tags }}
                
                {{ $t := lower . }}
                {{ $badgeClass := "badge-default" }}
                {{ $badgeSymbol := "" }}

                {{ if eq $t "web" }}
                  {{ $badgeClass = "badge-web" }}
                  {{ $badgeSymbol = "web-icon.svg" }}
                {{ else if eq $t "crypto" }}
                  {{ $badgeClass = "badge-crypto" }}
                  {{ $badgeSymbol = "crypto-icon.svg" }}
                {{ else if eq $t "pwn" }}
                  {{ $badgeClass = "badge-pwn" }}
                  {{ $badgeSymbol = "pwn-icon.svg" }}
                {{ else if eq $t "rev" }}
                  {{ $badgeClass = "badge-rev" }}
                  {{ $badgeSymbol = "rev-icon.svg" }}
                {{ else if eq $t "forensics" }}
                  {{ $badgeClass = "badge-forensics" }}
                  {{ $badgeSymbol = "forensics-icon.svg" }}
                {{ else if eq $t "misc" }}
                  {{ $badgeClass = "badge-misc" }}
                  {{ $badgeSymbol = "misc-icon.svg" }}
                {{ end }}

                {{/* Render the span with the manual class */}}
                <span class="m-1 badge-custom align-middle {{ $badgeClass }}">
                  {{ if ne $badgeSymbol "" }}
                    {{ $res := resources.Get (printf "icons/%s" $badgeSymbol) }}
                    {{ if $res }}
                      {{ $res.Content | safeHTML }}
                    {{ end }}
                  {{ end }}

                  {{ title . }}
                </span>

              {{ end }}
            </div>
            {{ end }}

          <div class="mt-3 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
             {{ partial "article-meta/term.html" (dict "context" . "scope" "single") }}
          </div>
        </div>
      </div>

    {{ else }}
      <h1 class="mt-5 text-4xl font-extrabold text-neutral-900 dark:text-neutral">{{ .Title }}</h1>
      <div class="mt-1 mb-2 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
        {{ partial "article-meta/term.html" (dict "context" . "scope" "single") }}
      </div>
    {{ end }}

  </header>

  <section class="flex flex-col max-w-full mt-0 mb-5 prose dark:prose-invert lg:flex-row">
    {{ if .Content }}<div class="min-w-0 min-h-0 max-w-prose">{{ .Content }}</div>{{ end }}
  </section>

  {{ if gt .Pages 0 }}
    {{ $cardView := .Params.cardView | default (site.Params.term.cardView | default false) }}
    <section class="w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3 mt-10">
      {{ range .Pages }}
        {{ partial "article-link/card.html" . }}
      {{ end }}
    </section>
  {{ else }}
    <section class="mt-10 prose dark:prose-invert">
      <p class="py-8 border-t"><em>{{ i18n "term.no_articles" | emojify }}</em></p>
    </section>
  {{ end }}

  {{ partial "pagination.html" . }}
{{ end }}
