{{ define "main" }}
  {{ .Scratch.Set "scope" "term" }}
  
  {{/* --- ROBUST ID CALCULATION --- */}}
  {{ $authorID := "" }}

  {{/* 1. Try to get ID from Physical File (The _index.md folder name) */}}
  {{ if .File }}
    {{ $authorID = .File.Dir | path.Base }}
  {{ end }}

  {{/* 2. If no file (Auto-generated page), try Taxonomy Term */}}
  {{ if and (not $authorID) .Data.Term }}
    {{ $authorID = .Data.Term }}
  {{ end }}

  {{/* 3. Fallback: Use the page title slugified */}}
  {{ if not $authorID }}
    {{ $authorID = .Title | urlize }}
  {{ end }}

  {{/* --- LOAD DATA --- */}}
  {{ $author := index site.Data.authors $authorID }}
  {{ $hasData := not (eq $author nil) }}

  <header class="mt-5">
    {{ if .Params.showBreadcrumbs | default (site.Params.term.showBreadcrumbs | default false) }}
      {{ partial "breadcrumbs.html" . }}
    {{ end }}

    {{/* CASE 1: We found Author Data (Render Profile) */}}
    {{ if $hasData }}
      <div class="flex flex-col items-center gap-4 mt-8 mb-8 text-center">
        
        {{/* Image Logic: Handles both local resources and static paths */}}
        {{ if $author.image }}
          <div class="relative w-48 h-48 flex-shrink-0">
            {{ $imagePath := strings.TrimPrefix "/" $author.image }} 
            {{ $imageResource := resources.Get $imagePath }}
            {{ $imgSrc := "" }}
            {{ if $imageResource }}
              {{ $imgSrc = $imageResource.RelPermalink }}
            {{ else }}
              {{ $imgSrc = $author.image | relURL }}
            {{ end }}

            <img src="{{ $imgSrc }}" class="rounded-full object-cover shadow-lg w-full h-full border-2 border-neutral-100 dark:border-neutral-700" alt="{{ $author.name }}">
          </div>
        {{ end }}

        <div class="flex-1 w-full">
          <h1 class="text-4xl font-extrabold text-neutral-900 dark:text-neutral-100 flex flex-wrap justify-center items-center gap-3">
            {{ $author.name }}
          </h1>

          {{ if $author.bio }}
            <div class="mt-3 text-lg text-neutral-600 dark:text-neutral-300 max-w-2xl mx-auto">
              {{ $author.bio | markdownify }}
            </div>
          {{ end }}

          {{ if $author.social }}
          <div class="mt-6 flex flex-wrap justify-center gap-4">
            {{ range $social := $author.social }}
              {{ range $network, $link := $social }}
              <a href="{{ $link }}" target="_blank" rel="noopener noreferrer" class="text-neutral-500 hover:text-primary-600 dark:text-neutral-400 dark:hover:text-primary-400">
                <span class="w-6 h-6 inline-block"> {{/* Fixed icon size */}}
                  {{ partial "icon.html" $network }}
                </span>
              </a>
              {{ end }}
            {{ end }}
          </div>
          {{ end }}

          {{ if $author.tags }}
          <div class="mt-8 max-w-2xl mx-auto flex flex-wrap justify-center gap-3">
            {{ range $author.tags }}
              {{ partial "category-badge.html" . }}
            {{ end }}
          </div>
          {{ end }}

        </div>
      </div>

    {{/* CASE 2: No Author Data (e.g. Main /authors/ list page) */}}
    {{ else }}
      <h1 class="mt-5 text-4xl font-extrabold text-neutral-900 dark:text-neutral">{{ .Title }}</h1>
      <div class="mt-1 mb-2 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
        {{ partial "article-meta/term.html" (dict "context" . "scope" "single") }}
      </div>
    {{ end }}

  </header>

  <section class="flex flex-col max-w-full mt-0 mb-5 prose dark:prose-invert lg:flex-row">
    {{ if .Content }}<div class="min-w-0 min-h-0 max-w-prose">{{ .Content }}</div>{{ end }}
  </section>

  {{ $cardView := .Params.cardView | default (site.Params.term.cardView | default false) }}
  <section class="w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3 mt-10">
  {{ range .Pages }}
    {{ partial "article-link/card.html" . }}
  {{ end }}
  </section>

  {{ partial "pagination.html" . }}
{{ end }}
